<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Dart Manager Pro v69.6.0 - FULL STABLE</title>
    <link href="https://fonts.googleapis.com/css2?family=Sora:wght@400;700;800&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #05070a; --card: #11141d; --accent: #00ff95; --warn: #ffb800; --danger: #ff4757; --text: #ffffff; --border: #1e293b; --purple: #a855f7; }
        body { margin: 0; background: var(--bg); color: var(--text); font-family: 'Sora', sans-serif; overflow-x: hidden; }
        
        /* LOGIKA WIDOKÓW */
        #tv-view { display: none; }
        body.tv-mode #admin-view, body.tv-mode .header { display: none !important; }
        body.tv-mode #tv-view { display: block !important; position: fixed; inset: 0; background: var(--bg); z-index: 9999; padding: 40px; }

        .container { padding: 20px; max-width: 1600px; margin: 0 auto; }
        .header { display: flex; justify-content: space-between; align-items: center; padding: 15px 25px; background: #0f172a; border: 1px solid var(--border); border-radius: 12px; margin-bottom: 20px; }
        
        /* PRZYCISKI I ETYKIETY */
        .btn { border: none; padding: 10px 16px; border-radius: 8px; font-weight: 800; cursor: pointer; text-transform: uppercase; font-size: 0.7rem; transition: 0.2s; }
        .match-card { background: var(--card); border: 1px solid var(--border); border-radius: 10px; margin-bottom: 6px; padding: 10px 15px; display: flex; align-items: center; gap: 12px; border-left: 8px solid transparent; }
        .role-pill { padding: 10px; border-radius: 6px; background: #000; text-align: center; font-weight: 700; border: 2px solid #1e293b; flex: 1; font-size: 0.85rem; }
        
        /* TV DESIGN - PEŁNA SZEROKOŚĆ */
        .tv-row { background: var(--card); border-left: 15px solid var(--accent); padding: 30px; margin-bottom: 20px; display: flex; align-items: center; border-radius: 10px; border: 1px solid var(--border); }
        .tv-t-num { width: 120px; font-size: 4rem; font-weight: 900; color: var(--accent); }
        .tv-main { flex: 1; }
        .tv-names { font-size: 3rem; font-weight: 800; text-transform: uppercase; display: flex; justify-content: space-between; align-items: center; }
        .tv-marker-box { font-size: 1.5rem; color: var(--warn); font-weight: 700; }
        .tv-timer { width: 220px; text-align: right; font-size: 3.5rem; font-weight: 900; color: var(--accent); font-family: monospace; }
        
        .tab { padding: 12px 24px; border-radius: 10px; cursor: pointer; font-weight: 800; border: 2px solid var(--border); margin-right: 10px; display: inline-block; }
    </style>
</head>
<body>

<div id="admin-view" class="container">
    <div class="header">
        <h2 style="margin:0; color:var(--accent)">DART MANAGER PRO v69.6.0</h2>
        <div style="display:flex; gap:10px">
            <button onclick="window.location.search='?view=tv'" class="btn" style="background:var(--accent); color:#000">WIDOK TV</button>
            <button onclick="document.getElementById('csvIn').click()" class="btn" style="background:#333; color:#fff">IMPORT CSV</button>
            <input type="file" id="csvIn" style="display:none" onchange="doImport(this)">
        </div>
    </div>
    <div id="tabs"></div>
    <div id="matches" style="margin-top:20px"></div>
</div>

<div id="tv-view">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:40px">
        <h1 style="margin:0; letter-spacing:10px; color:var(--accent)">LIVE SCORES</h1>
        <button onclick="window.location.search=''" class="btn" style="background:#fff; color:#000">POWRÓT</button>
    </div>
    <div id="tv-list"></div>
</div>

<script>
    // Powrót do Twojej stabilnej struktury danych
    let state = { 
        leagues: [{ name: 'LIGA 1', color: '#00ff95', matches: [] }], 
        idx: 0,
        markers: ["Mecz 1", "Mecz 2", "Liczy A", "Liczy B"] // Tutaj będą Twoje dane z CSV
    };

    // Detekcja trybu TV
    if (window.location.search.includes('view=tv')) {
        document.body.classList.add('tv-mode');
    }

    function doImport(input) {
        const file = input.files[0]; if(!file) return;
        const reader = new FileReader();
        reader.onload = function(e) {
            const lines = e.target.result.split(/\r?\n/).filter(l => l.trim().length > 0);
            state.leagues[state.idx].matches = lines.slice(1).map(line => {
                const c = line.split(line.includes(';')?';':',').map(x => x.trim());
                return { 
                    id: 'm-'+Math.random().toString(36).substr(2,9), 
                    b: c[0]||'1', h: c[1]||'?', g: c[2]||'?', 
                    m: c[3]||'', // Marker
                    s: 'plan', e: '00:00', start: null 
                };
            });
            alert("Pomyślnie zaimportowano " + state.leagues[state.idx].matches.length + " meczów!");
            refresh();
        };
        reader.readAsText(file);
    }

    function refresh() {
        const cur = state.leagues[state.idx];
        
        // Render Tabs
        document.getElementById('tabs').innerHTML = state.leagues.map((l, i) => `
            <div class="tab" style="${i===state.idx?'background:'+l.color+'; color:#000':'color:'+l.color}" onclick="state.idx=${i}; refresh();">${l.name}</div>
        `).join('');

        // Admin Matches
        document.getElementById('matches').innerHTML = cur.matches.map(m => `
            <div class="match-card" style="border-left-color:${cur.color}">
                <div style="width:40px; font-weight:900">T${m.b}</div>
                <div class="role-pill">${m.h}</div>
                <div style="opacity:0.3">VS</div>
                <div class="role-pill">${m.g}</div>
                <div style="width:150px; color:var(--warn); font-size:0.8rem">MARKER: ${m.m}</div>
                <div style="width:150px; text-align:right">
                    ${m.s==='plan' ? `<button onclick="start('${m.id}')" class="btn" style="background:var(--accent); color:#000">START</button>` : ''}
                    ${m.s==='live' ? `<button onclick="stop('${m.id}')" class="btn" style="background:var(--danger); color:#fff">STOP ${m.e}</button>` : ''}
                </div>
            </div>`).join('') || '<p style="text-align:center; opacity:0.2; margin-top:50px">BRAK DANYCH. ZAIMPORTUJ PLIK CSV.</p>';

        // TV Render
        let live = [];
        state.leagues.forEach(l => l.matches.forEach(m => { if(m.s==='live') live.push({...m, col: l.color}); }));
        document.getElementById('tv-list').innerHTML = live.length ? live.map(m => `
            <div class="tv-row" style="border-left-color:${m.col}">
                <div class="tv-t-num">T${m.b}</div>
                <div class="tv-main">
                    <div class="tv-names">
                        <span>${m.h} <span style="opacity:0.3">vs</span> ${m.g}</span>
                        <span class="tv-marker-box">MARKER: ${m.m}</span>
                    </div>
                </div>
                <div class="tv-timer">${m.e}</div>
            </div>`).join('') : '<h2 style="text-align:center; opacity:0.1; margin-top:100px">CZEKAMY NA MECZE LIVE...</h2>';
    }

    function start(id) { 
        state.leagues[state.idx].matches.forEach(m => { 
            if(m.id===id){ m.s='live'; m.start=Date.now(); } 
        }); 
        refresh(); 
    }
    
    function stop(id) { 
        if(confirm("Czy na pewno zakończyć ten mecz?")) {
            state.leagues[state.idx].matches.forEach(m => { if(m.id===id) m.s='done'; }); 
            refresh();
        }
    }

    setInterval(() => {
        state.leagues.forEach(l => l.matches.forEach(m => {
            if(m.s === 'live' && m.start) {
                const d = Math.floor((Date.now() - m.start) / 1000);
                m.e = Math.floor(d/60).toString().padStart(2,'0')+':'+(d%60).toString().padStart(2,'0');
            }
        }));
        refresh();
    }, 1000);

    refresh();
</script>
</body>
</html>
